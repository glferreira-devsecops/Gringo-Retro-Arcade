<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gringo's Retro Arcade</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #BB86FC;
      --secondary-color: #03DAC6;
      --background-color: #121212;
      --surface-color: #1e1e1e;
      --on-surface-color: #ffffff;
      --error-color: #CF6679;
    }

    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    body, html {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Press Start 2P', cursive;
      color: var(--on-surface-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: linear-gradient(-45deg, #121212, #1a1a2e, #2a1a2e, #121212);
      background-size: 400% 400%;
      animation: gradientAnimation 15s ease infinite;
    }

    #main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 90vw;
      max-width: 1400px;
      height: 95vh;
      box-shadow: 0 15px 40px rgba(0,0,0,0.5);
      border-radius: 24px;
      gap: 15px;
      padding: 15px;
      background: rgba(20, 20, 20, 0.7);
      border: 3px solid var(--primary-color);
    }

    h1 {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      color: var(--primary-color);
      text-transform: uppercase;
      margin: 0 0 10px 0;
      letter-spacing: 3px;
      text-shadow: 3px 3px 0 var(--surface-color), 6px 6px 0 rgba(0, 0, 0, 0.2);
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    h1:hover {
      transform: scale(1.05);
    }

    /* Layout Grid */
    .layout {
      display: grid;
      grid-template-columns: 1fr 280px;
      gap: 15px;
      flex: 1;
      width: 100%;
      min-height: 0;
    }

    @media (max-width: 1100px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    /* Header Controls */
    .header-section {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
      width: 100%;
      justify-content: space-between;
    }

    #core-select {
      background-color: var(--surface-color);
      color: var(--on-surface-color);
      border: 2px solid var(--primary-color);
      padding: 8px 12px;
      border-radius: 8px;
      font-family: 'Press Start 2P', cursive;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #core-select:hover {
      background: rgba(187, 134, 252, 0.2);
      box-shadow: 0 0 15px var(--primary-color);
    }

    .header-btn {
      background: var(--secondary-color);
      color: var(--background-color);
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
      font-size: 11px;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .header-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px var(--secondary-color);
    }

    /* Game Container */
    #game-container {
      position: relative;
      width: 100%;
      height: 100%;
      background-color: #000;
      border-radius: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      border: 3px solid var(--secondary-color);
      box-shadow: inset 0 0 30px rgba(3, 218, 198, 0.15);
      min-height: 450px;
    }

    #game-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(rgba(0, 0, 0, 0.25) 50%, rgba(0, 0, 0, 0.1) 50%);
      background-size: 100% 6px;
      z-index: 5;
      pointer-events: none;
      opacity: 0.1;
    }

    #game {
      width: 100%;
      height: 100%;
      background-color: #000;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      position: relative;
      z-index: 1;
    }

    #loader {
      position: absolute;
      border: 8px solid rgba(187, 134, 252, 0.3);
      border-top: 8px solid var(--primary-color);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      z-index: 10;
      box-shadow: 0 0 25px var(--primary-color);
    }

    .hidden {
      display: none !important;
    }

    /* Controls Section */
    #controls {
      width: 100%;
      padding: 15px;
      background-color: var(--surface-color);
      border-radius: 10px;
      border: 3px solid var(--primary-color);
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
    }

    .control-btn {
      cursor: pointer;
      padding: 10px 20px;
      background: linear-gradient(135deg, var(--primary-color) 0%, #9966FF 100%);
      color: var(--background-color);
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(187, 134, 252, 0.3);
      font-family: 'Press Start 2P', cursive;
      font-weight: bold;
    }

    .control-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--secondary-color) 0%, #00B8A0 100%);
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(3, 218, 198, 0.5);
      border-color: var(--secondary-color);
    }

    .control-btn:active:not(:disabled) {
      transform: translateY(-1px);
    }

    .control-btn:disabled {
      background: linear-gradient(135deg, #555 0%, #333 100%);
      cursor: not-allowed;
      opacity: 0.5;
      box-shadow: none;
    }

    .control-btn i {
      font-size: 14px;
    }

    /* Status */
    #status {
      margin-top: 10px;
      font-size: 12px;
      color: var(--secondary-color);
      text-align: center;
      padding: 10px;
      background: rgba(3, 218, 198, 0.15);
      border: 2px solid var(--secondary-color);
      border-radius: 8px;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1.3;
    }

    #status.success {
      color: #4ade80;
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.15);
    }

    #status.error {
      color: var(--error-color);
      border-color: var(--error-color);
      background: rgba(207, 102, 121, 0.15);
    }

    /* Sidebar - Recommended Games */
    .sidebar {
      background: linear-gradient(135deg, rgba(30, 30, 30, 0.9) 0%, rgba(20, 20, 20, 0.9) 100%);
      border: 2px solid var(--primary-color);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      height: 100%;
      min-height: 0;
      box-shadow: 0 8px 30px rgba(187, 134, 252, 0.15);
    }

    .sidebar h2 {
      margin: 0;
      font-size: 11px;
      color: var(--secondary-color);
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 8px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .games-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      overflow-y: auto;
    }

    .game-item {
      background: rgba(187, 134, 252, 0.15);
      border: 2px solid rgba(187, 134, 252, 0.4);
      border-radius: 6px;
      padding: 9px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 10px;
      word-break: break-word;
      line-height: 1.2;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      font-weight: bold;
    }

    .game-item:hover {
      background: var(--primary-color);
      color: var(--background-color);
      transform: translateX(5px);
      border-color: var(--secondary-color);
      box-shadow: 0 4px 15px rgba(187, 134, 252, 0.5);
    }

    .game-item.active {
      background: var(--secondary-color);
      color: var(--background-color);
      border-color: var(--secondary-color);
      box-shadow: 0 4px 15px rgba(3, 218, 198, 0.5);
    }

    .game-console {
      font-size: 9px;
      opacity: 0.8;
      margin-top: 3px;
      color: var(--secondary-color);
    }

    /* Tutorial Modal */
    #tutorial-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }

    #tutorial-modal.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-box {
      background: var(--surface-color);
      border: 3px solid var(--primary-color);
      border-radius: 12px;
      padding: 20px;
      max-width: 550px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(187, 134, 252, 0.4);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 13px;
      color: var(--primary-color);
      letter-spacing: 1px;
    }

    .close-btn {
      background: none;
      border: none;
      color: var(--on-surface-color);
      font-size: 28px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .close-btn:hover {
      color: var(--secondary-color);
      transform: rotate(90deg);
    }

    .step {
      margin-bottom: 12px;
      padding: 10px;
      background: rgba(187, 134, 252, 0.1);
      border-left: 3px solid var(--secondary-color);
      border-radius: 5px;
    }

    .step h3 {
      margin: 0 0 6px 0;
      font-size: 10px;
      color: var(--secondary-color);
      letter-spacing: 0.5px;
    }

    .step p {
      margin: 0;
      font-size: 9px;
      color: var(--on-surface-color);
      line-height: 1.4;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary-color);
    }

    /* Responsive */
    @media (max-width: 1100px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .sidebar {
        max-height: 250px;
      }
    }

    @media (max-width: 768px) {
      #main-container {
        width: 95vw;
        padding: 10px;
        gap: 10px;
      }

      h1 {
        font-size: 1.2rem;
        margin-bottom: 8px;
      }

      .header-section {
        gap: 8px;
      }

      #core-select, .header-btn {
        font-size: 10px;
        padding: 6px 10px;
      }

      #controls {
        gap: 8px;
        padding: 10px;
      }

      .control-btn {
        padding: 8px 12px;
        font-size: 10px;
        gap: 4px;
      }

      .control-btn i {
        font-size: 12px;
      }

      .game-item {
        padding: 8px;
        font-size: 9px;
      }

      .modal-box {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div id="main-container">
    <h1>Gringo's Retro Arcade</h1>

    <div class="header-section">
      <select id="core-select" title="Selecione um console">
        <option value="nes">NES</option>
        <option value="snes">SNES</option>
        <option value="gb">Game Boy</option>
        <option value="gbc">Game Boy Color</option>
        <option value="gba">Game Boy Advance</option>
        <option value="vb">Virtual Boy</option>
        <option value="n64">Nintendo 64</option>
        <option value="nds">Nintendo DS</option>
        <option value="segaMS">Sega Master System</option>
        <option value="segaMD">Sega Mega Drive</option>
        <option value="segaCD">Sega CD</option>
        <option value="segaGG">Sega Game Gear</option>
        <option value="sega32x">Sega 32X</option>
        <option value="segaSaturn">Sega Saturn</option>
        <option value="psx">PlayStation</option>
        <option value="atari2600">Atari 2600</option>
        <option value="atari7800">Atari 7800</option>
        <option value="lynx">Atari Lynx</option>
        <option value="pce">PC Engine/TurboGrafx-16</option>
        <option value="ws">WonderSwan</option>
        <option value="ngp">Neo Geo Pocket</option>
      </select>
      <button class="header-btn" id="help-btn">
        <i class="fas fa-question-circle"></i> Ajuda
      </button>
    </div>

    <div class="layout">
      <!-- Game Area -->
      <div style="display: flex; flex-direction: column; gap: 10px; min-height: 0;">
        <div id="game-container">
          <div id="loader" class="hidden"></div>
          <div id="game"></div>
        </div>

        <div id="controls">
          <button id="uploadLabel" class="control-btn">
            <i class="fas fa-upload"></i> Carregar ROM
          </button>
          <button id="resetBtn" class="control-btn" disabled>
            <i class="fas fa-redo"></i> Reiniciar
          </button>
          <button id="saveBtn" class="control-btn" disabled>
            <i class="fas fa-save"></i> Salvar
          </button>
          <button id="loadBtn" class="control-btn" disabled>
            <i class="fas fa-folder-open"></i> Carregar
          </button>
          <button id="fullscreenBtn" class="control-btn">
            <i class="fas fa-expand"></i> Tela Cheia
          </button>
        </div>

        <div id="status">Selecione o console e carregue uma ROM para começar!</div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar">
        <h2><i class="fas fa-star"></i> Recomendados</h2>
        <div class="games-list" id="games-list"></div>
      </div>
    </div>
  </div>

  <!-- Tutorial Modal -->
  <div id="tutorial-modal">
    <div class="modal-box">
      <div class="modal-header">
        <h2>Como Usar</h2>
        <button class="close-btn" id="close-modal">×</button>
      </div>

      <div class="step">
        <h3>1 - SELECIONE UM CONSOLE</h3>
        <p>Use o dropdown no topo para escolher NES, SNES, GBA, Genesis, PlayStation ou outro console.</p>
      </div>

      <div class="step">
        <h3>2 - ESCOLHA UM JOGO</h3>
        <p>Clique em um dos jogos recomendados na lista lateral ou carregue sua própria ROM.</p>
      </div>

      <div class="step">
        <h3>3 - CONTROLES</h3>
        <p>Setas: Movimento | Z: Botão A | X: Botão B | A: L | S: R</p>
      </div>

      <div class="step">
        <h3>4 - SALVE SEU PROGRESSO</h3>
        <p>Use "Salvar" durante o jogo e "Carregar" para continuar depois.</p>
      </div>

      <div class="step">
        <h3>5 - EASTER EGG</h3>
        <p>Digite o código Konami: ↑ ↑ ↓ ↓ ← → ← → B A</p>
      </div>
    </div>
  </div>

  <input type="file" id="romUpload" style="display: none;" accept=".nes,.smc,.gba,.md,.bin,.iso,.chd">

  <script>
    // Games Database
    const GAMES_DB = {
      nes: [
        { name: 'Super Mario Bros.', url: 'https://archive.org/download/super-mario-bros-nes/Super%20Mario%20Bros.%20%28U%29%20%5B%21%5D.nes' },
        { name: 'The Legend of Zelda', url: 'https://archive.org/download/legend-of-zelda-nes/Legend%20of%20Zelda%2C%20The%20%28U%29%20%28PRG1%29.nes' },
        { name: 'Mega Man 2', url: 'https://archive.org/download/mega-man-2-nes/Mega%20Man%202%20%28U%29.nes' },
        { name: 'Pac-Man', url: 'https://archive.org/download/pacman-nes/Pac-Man%20%28U%29%20%5B%21%5D.nes' }
      ],
      snes: [
        { name: 'Super Mario World', url: 'https://archive.org/download/super-mario-world-snes/Super%20Mario%20World%20%28U%29%20%5B%21%5D.smc' },
        { name: 'F-Zero', url: 'https://archive.org/download/f-zero-snes/F-Zero%20%28U%29%20%5B%21%5D.smc' }
      ],
      gba: [
        { name: 'Kirby Amazing Mirror', url: 'https://archive.org/download/kirby-amazing-mirror-gba/Kirby%20%26%20The%20Amazing%20Mirror%20%28U%29.gba' }
      ],
      segaMD: [
        { name: 'Sonic the Hedgehog', url: 'https://archive.org/download/sonic-the-hedgehog-sega-genesis/Sonic%20the%20Hedgehog%20%28U%29%20%28REV00%29%20%28World%29.md' },
        { name: 'Sonic 2', url: 'https://archive.org/download/sonic-the-hedgehog-2-sega-genesis/Sonic%20the%20Hedgehog%202%20%28U%29%20%28World%29.md' }
      ]
    };

    // DOM Elements
    const getEl = (id) => document.getElementById(id);
    const coreSelect = getEl('core-select');
    const uploadLabel = getEl('uploadLabel');
    const romUpload = getEl('romUpload');
    const statusDiv = getEl('status');
    const fullscreenBtn = getEl('fullscreenBtn');
    const resetBtn = getEl('resetBtn');
    const saveBtn = getEl('saveBtn');
    const loadBtn = getEl('loadBtn');
    const gameContainer = getEl('game-container');
    const loader = getEl('loader');
    const gamesList = getEl('games-list');
    const tutorialModal = getEl('tutorial-modal');
    const helpBtn = getEl('help-btn');
    const closeModal = getEl('close-modal');

    let currentGame = null;
    let isRunning = false;

    // Utility Functions
    const setStatus = (msg, type = '') => {
      statusDiv.textContent = msg;
      statusDiv.className = `${type}`;
    };

    const setButtonsDisabled = (disabled) => {
      uploadLabel.disabled = disabled;
      resetBtn.disabled = !isRunning;
      saveBtn.disabled = !isRunning;
      loadBtn.disabled = !isRunning;
    };

    const showLoader = (visible) => {
      loader.classList.toggle('hidden', !visible);
    };

    const renderGamesList = () => {
      const console = coreSelect.value;
      const games = GAMES_DB[console] || [];
      gamesList.innerHTML = '';

      if (games.length === 0) {
        gamesList.innerHTML = '<div class="game-item" style="text-align: center; opacity: 0.5;">Nenhum jogo</div>';
        return;
      }

      games.forEach(game => {
        const div = document.createElement('div');
        div.className = 'game-item';
        div.innerHTML = `<strong>${game.name}</strong><div class="game-console">${console.toUpperCase()}</div>`;
        div.addEventListener('click', () => loadGame(game));
        gamesList.appendChild(div);
      });
    };

    // Emulator Config
    window.EJS_player = '#game';
    window.EJS_core = 'nes';
    window.EJS_gameName = 'Gringo Retro Arcade';
    window.EJS_color = '#BB86FC';
    window.EJS_startOnLoaded = true;
    window.EJS_pathtodata = 'https://cdn.emulatorjs.org/stable/data/';

    window.EJS_onGameStart = () => {
      setStatus(`▶️ ${currentGame} iniciado!`, 'success');
      isRunning = true;
      setButtonsDisabled(false);
      showLoader(false);
    };

    // Load Game
    const loadGame = (game) => {
      try {
        currentGame = game.name;
        window.EJS_core = coreSelect.value;
        window.EJS_gameUrl = game.url;
        window.EJS_gameName = game.name;

        setStatus(`⏳ Carregando ${game.name}...`);
        showLoader(true);
        setButtonsDisabled(true);

        const oldScript = document.querySelector('script[src*="loader.js"]');
        if (oldScript) oldScript.remove();
        getEl('game').innerHTML = '';

        const script = document.createElement('script');
        script.src = 'https://cdn.emulatorjs.org/stable/data/loader.js';
        script.onerror = () => {
          setStatus('❌ Erro ao carregar jogo.', 'error');
          showLoader(false);
          setButtonsDisabled(false);
        };
        document.body.appendChild(script);
      } catch (e) {
        console.error('Erro:', e);
        setStatus('❌ Erro ao carregar.', 'error');
        showLoader(false);
      }
    };

    // Event Listeners
    coreSelect.addEventListener('change', () => {
      renderGamesList();
      setStatus(`Console: ${coreSelect.options[coreSelect.selectedIndex].text}`);
    });

    uploadLabel.addEventListener('click', () => romUpload.click());

    romUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (evt) => {
        loadGame({ name: file.name, url: evt.target.result });
      };
      reader.onerror = () => {
        setStatus('❌ Erro ao ler arquivo.', 'error');
      };
      reader.readAsArrayBuffer(file);
    });

    resetBtn.addEventListener('click', () => {
      const oldScript = document.querySelector('script[src*="loader.js"]');
      if (oldScript) oldScript.remove();
      getEl('game').innerHTML = '';
      setStatus('🔄 Jogo reiniciado!', 'success');
      isRunning = false;
      setButtonsDisabled(true);
    });

    saveBtn.addEventListener('click', () => {
      if (isRunning && typeof EJS_savestate === 'function') {
        EJS_savestate();
        setStatus('💾 Jogo salvo!', 'success');
      }
    });

    loadBtn.addEventListener('click', () => {
      if (isRunning && typeof EJS_loadstate === 'function') {
        EJS_loadstate();
        setStatus('📂 Jogo carregado!', 'success');
      }
    });

    fullscreenBtn.addEventListener('click', () => {
      if (document.fullscreenElement) {
        document.exitFullscreen();
      } else {
        gameContainer.requestFullscreen().catch(console.error);
      }
    });

    document.addEventListener('fullscreenchange', () => {
      fullscreenBtn.innerHTML = document.fullscreenElement
        ? '<i class="fas fa-compress"></i> Sair'
        : '<i class="fas fa-expand"></i> Tela Cheia';
    });

    helpBtn.addEventListener('click', () => {
      tutorialModal.classList.add('show');
    });

    closeModal.addEventListener('click', () => {
      tutorialModal.classList.remove('show');
    });

    tutorialModal.addEventListener('click', (e) => {
      if (e.target === tutorialModal) {
        tutorialModal.classList.remove('show');
      }
    });

    // Konami Code
    const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
    let konamiIndex = 0;

    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === konamiCode[konamiIndex].toLowerCase()) {
        konamiIndex++;
        if (konamiIndex === konamiCode.length) {
          document.body.style.filter = 'invert(1) hue-rotate(180deg)';
          setTimeout(() => {
            document.body.style.filter = '';
          }, 400);
          setStatus('🎮 CÓDIGO KONAMI ATIVADO!', 'success');
          konamiIndex = 0;
        }
      } else {
        konamiIndex = 0;
      }
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderGamesList();
      setStatus('Selecione o console e carregue uma ROM para começar!');
    });

    window.addEventListener('load', () => {
      const hasVisited = localStorage.getItem('gringo-arcade-visited');
      if (!hasVisited) {
        setTimeout(() => {
          tutorialModal.classList.add('show');
          localStorage.setItem('gringo-arcade-visited', 'true');
        }, 800);
      }
    });
  </script>
</body>
</html>
